<!doctype html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>CompoLink Platform</title>
  <meta name="description" content="CompoLink – connect EU composite buyers & suppliers in one platform." />
  <meta name="theme-color" content="#0b1020" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <noscript>
    Deze website heeft JavaScript nodig om te werken (login, feed, analytics).
  </noscript>

  <!-- ============ AUTH SCHERM ============ -->
  <div id="auth-wrapper" class="auth-wrapper">
    <div class="auth-card">
      <h1>CompoLink</h1>
      <p class="auth-subtitle">
        Connect EU composite buyers & suppliers in één platform.
      </p>

      <div class="auth-tabs">
        <button id="login-tab" class="auth-tab active" type="button">Log in</button>
        <button id="signup-tab" class="auth-tab" type="button">Sign up</button>
      </div>

      <!-- LOGIN -->
      <form id="login-form" class="auth-form">
        <label>
          E-mail
          <input type="email" id="login-email" autocomplete="email" required />
        </label>
        <label>
          Wachtwoord
          <input
            type="password"
            id="login-password"
            autocomplete="current-password"
            required
          />
        </label>
        <p id="login-error" class="auth-error" aria-live="polite"></p>
        <button type="submit" class="primary-btn">Log in</button>
      </form>

      <!-- SIGNUP -->
      <form id="signup-form" class="auth-form hidden">
        <label>
          Naam
          <input type="text" id="signup-name" autocomplete="name" required />
        </label>
        <label>
          E-mail
          <input type="email" id="signup-email" autocomplete="email" required />
        </label>
        <label>
          Wachtwoord
          <input
            type="password"
            id="signup-password"
            autocomplete="new-password"
            required
          />
        </label>

        <fieldset class="role-fieldset">
          <legend>Accounttype</legend>
          <label>
            <input type="radio" name="signup-role" value="buyer" checked />
            Buyer (OEM / MRO / integrator)
          </label>
          <label>
            <input type="radio" name="signup-role" value="seller" />
            Seller (materials / semi-finished)
          </label>
        </fieldset>

        <p id="signup-error" class="auth-error" aria-live="polite"></p>
        <button type="submit" class="primary-btn">Account aanmaken</button>
      </form>
    </div>
  </div>

  <!-- ============ APP (NA INLOGGEN) ============ -->
  <div id="app" class="app hidden">
    <!-- TOP NAV -->
    <header class="top-nav">
      <div class="nav-left">
        <span class="nav-logo">CompoLink</span>
      </div>

      <nav class="nav-center" aria-label="Primary navigation">
        <button class="nav-btn active" type="button" data-page="overview">Overview</button>
        <button class="nav-btn" type="button" data-page="stock">Stock</button>
        <button class="nav-btn" type="button" data-page="buyers">Buyers & Suppliers</button>
        <button class="nav-btn" type="button" data-page="analytics">Analytics</button>
        <button class="nav-btn" type="button" data-page="tracking">Tracking</button>
        <button class="nav-btn" type="button" data-page="community">Community feed</button>
        <button class="nav-btn" type="button" data-page="joint">Joint purchase</button>
        <button class="nav-btn" type="button" data-page="checkout">Checkout</button>
      </nav>

      <div class="nav-right">
        <span class="user-tag" id="user-tag">–</span>
        <button id="logout-btn" class="logout-btn" type="button">Log out</button>
      </div>
    </header>

    <!-- GLOBAL LIVE KOERSEN STRIP -->
    <div id="market-strip" class="market-strip">
      <span class="market-strip-label">Live material prices</span>
      <ul id="market-prices-strip" class="market-prices-strip"></ul>
      <span class="market-strip-note">
        Indicatieve spotprijzen (goud, zilver, etc.) in USD.
      </span>
    </div>

    <main class="main-wrapper">
      <!-- ===== OVERVIEW ===== -->
      <section id="overview" class="page active-page">
        <div class="hero-shell">
          <div class="hero-card">
            <p class="hero-kicker">
              YOUR DIGITAL MARKETPLACE FOR COMPOSITE MATERIALS
            </p>
            <h1 class="hero-title">
              Connect buyers and suppliers of<br />composite materials.
            </h1>
            <p class="hero-text">
              CompoLink brings together European composite suppliers on a single
              platform. Buyers can instantly see which materials are in stock,
              including price, quality, lead time, and certifications – with
              complete transparency.
            </p>

            <div class="hero-actions">
              <button class="hero-btn primary-btn" type="button" data-page="stock">
                View stock
              </button>
              <button class="hero-btn ghost-btn" type="button" data-page="community">
                Community feed
              </button>
            </div>

            <div class="hero-tags">
              <span class="hero-tag">RFID track &amp; trace</span>
              <span class="hero-tag">Min / max orders</span>
              <span class="hero-tag">Real-time stock insight</span>
              <span class="hero-tag">5% platform fee</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== STOCK PAGE ===== -->
      <section id="stock" class="page">
        <h2>Stock overview</h2>
        <p class="page-intro">
          Live material prices links, gecombineerd met actuele stockdata in het
          CompoLink netwerk.
        </p>

        <div class="stock-layout">
          <aside class="prices-panel">
            <h3>Live material prices</h3>
            <ul id="market-prices-card" class="market-prices-list"></ul>
            <p class="market-note">
              Indicatieve spotprijzen (goud, zilver, etc.) in USD. Automatisch
              ververst (demo).
            </p>
          </aside>

          <div class="stock-panel">
            <div class="stock-table-card">
              <h3>Material list</h3>
              <table class="stock-table">
                <thead>
                  <tr>
                    <th>Materiaal</th>
                    <th>Prijs €/kg</th>
                    <th>Beschikbaar (kg)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-item='{"id":"mat-carbon","name":"Carbon prepreg T700","price":38,"weight":50}'>
                    <td>Carbon prepreg T700</td>
                    <td>€38,00</td>
                    <td>1500</td>
                    <td><button type="button" class="add-to-cart">In mandje</button></td>
                  </tr>
                  <tr data-item='{"id":"mat-epoxy","name":"Epoxy resin system 2K","price":9.5,"weight":25}'>
                    <td>Epoxy resin system 2K</td>
                    <td>€9,50</td>
                    <td>3200</td>
                    <td><button type="button" class="add-to-cart">In mandje</button></td>
                  </tr>
                  <tr data-item='{"id":"mat-glass","name":"Glass fabric 450 g/m²","price":4.2,"weight":30}'>
                    <td>Glass fabric 450 g/m²</td>
                    <td>€4,20</td>
                    <td>7800</td>
                    <td><button type="button" class="add-to-cart">In mandje</button></td>
                  </tr>
                </tbody>
              </table>
            </div>

            <aside class="cart-card">
              <h3>Mini-cart</h3>
              <ul id="cart-items" class="cart-items"></ul>
              <p id="cart-empty-msg" class="muted">Je mandje is nog leeg.</p>
              <p>Totaal gewicht: <span id="cart-weight">0.0</span> kg</p>
              <p>Materiaalprijs: €<span id="cart-total">0.00</span></p>
            </aside>
          </div>
        </div>
      </section>

      <!-- ===== BUYERS & SUPPLIERS ===== -->
      <section id="buyers" class="page">
        <div class="card">
          <h2>Buyers &amp; Suppliers</h2>
          <p class="page-intro">
            Hier kun je later supplier-profielen, certificaten en matching
            logica tonen. Voor nu is dit een nette placeholder.
          </p>
        </div>
      </section>

      <!-- ===== ANALYTICS ===== -->
      <section id="analytics" class="page">
        <h2>Analytics</h2>
        <p class="page-intro">Demo-visualisatie van volumes per materiaaltype.</p>
        <div class="card">
          <div class="chart-wrapper">
            <canvas id="stockChart"></canvas>
          </div>
        </div>
      </section>

      <!-- ===== TRACKING ===== -->
      <section id="tracking" class="page">
        <div class="card">
          <h2>Tracking</h2>
          <p class="page-intro">
            Trackingpagina voor toekomstige RFID / shipment tracking. Nu nog placeholder.
          </p>
        </div>
      </section>

      <!-- ===== COMMUNITY FEED ===== -->
      <section id="community" class="page">
        <div class="community-shell">
          <div class="community-card">
            <h2>Community feed</h2>
            <p class="page-intro">
              Share updates on price, stock, certificates, and RFQs. New users can also see older posts.
            </p>

            <div class="community-layout">
              <aside class="community-sidebar">
                <h3>Groups</h3>
                <ul id="group-list" class="group-list"></ul>
              </aside>

              <div class="community-main">
                <div class="community-header">
                  <h3>Post an update in <span id="current-group-name">Market updates</span></h3>
                </div>

                <div id="post-feed" class="post-feed"></div>

                <form id="post-form" class="post-form">
                  <textarea
                    id="post-text"
                    rows="3"
                    placeholder="For example, 'New batch of T700 prepreg available, price update €23.90/kg...'"
                  ></textarea>

                  <div class="post-form-row">
                    <input type="file" id="post-file" />
                    <button id="postBtn" type="submit" class="primary-btn">Plaatsen</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>
<!-- ===== JOINT PURCHASE ===== -->
<section id="joint" class="page">
  <div class="joint-shell">
    <div class="joint-header">
      <h2>Joint purchase</h2>
      <p class="page-intro">
        Pool demand with other buyers to unlock better pricing tiers. Suppliers can respond with lead time and MOQ.
        (Demo)
      </p>
    </div>

    <div class="joint-layout">
      <!-- LEFT: campaigns -->
      <div class="joint-card">
        <div class="jp-top">
          <h3>Active group-buys</h3>
          <div class="jp-steps" aria-label="Joint purchase steps">
            <div class="jp-step active">1. Select</div>
            <div class="jp-step">2. Contribute</div>
            <div class="jp-step">3. Confirm</div>
          </div>
        </div>

        <div id="jp-list" class="jp-list"></div>
      </div>

      <!-- RIGHT: create + join -->
      <div class="joint-card">
        <h3>Create a joint purchase</h3>
        <form id="jp-create-form" class="jp-form">
          <label>
            Material
            <select id="jp-material" required>
              <option value="Carbon prepreg T700">Carbon prepreg T700</option>
              <option value="Epoxy resin system 2K">Epoxy resin system 2K</option>
              <option value="Glass fabric 450 g/m²">Glass fabric 450 g/m²</option>
            </select>
          </label>

          <div class="jp-form-grid">
            <label>
              Target (kg)
              <input id="jp-target-kg" type="number" min="50" step="10" value="500" required />
            </label>
            <label>
              Baseline price (€/kg)
              <input id="jp-base-price" type="number" min="0.1" step="0.1" value="38" required />
            </label>
          </div>

          <label>
            Campaign title
            <input id="jp-title" type="text" placeholder="e.g., Q1 T700 prepreg group buy" required />
          </label>

          <button type="submit" class="primary-btn">Create campaign</button>
          <p id="jp-create-msg" class="muted" style="margin:0.4rem 0 0;"></p>
        </form>

        <div class="jp-divider"></div>

        <h3>Join selected campaign</h3>
        <div id="jp-selected" class="jp-selected muted">
          Select a campaign on the left to see details here.
        </div>

        <form id="jp-join-form" class="jp-form">
          <label>
            Contribution (€)
            <input id="jp-amount" type="number" min="50" step="50" placeholder="e.g., 500" required />
          </label>
          <button type="submit" class="primary-btn">Join &amp; reserve</button>
          <p id="jp-join-msg" class="muted" style="margin:0.4rem 0 0;"></p>
        </form>
      </div>
    </div>
  </div>
</section>
      <!-- ===== CHECKOUT ===== -->
      <section id="checkout" class="page">
        <div class="checkout-shell">
          <div class="checkout-card">
            <h2>Checkout &amp; Shipping Costs (Demo)</h2>
            <p class="page-intro">
              This demo shows how shipping costs can be automatically
              calculated based on destination and total weight. Rates are
              approximations inspired by PostNL, but <strong>not live or official prices</strong>.
            </p>

            <div class="checkout-grid">
              <div class="checkout-left">
                <h3>Shipping information</h3>
                <form id="shipping-form" class="shipping-form">
                  <label>
                    Name
                    <input type="text" id="ship-name" placeholder="Recipient name" />
                  </label>
                  <label>
                    E-mail
                    <input type="email" id="ship-email" placeholder="ontvanger@bedrijf.com" />
                  </label>
                  <label>
                    Address
                    <input type="text" id="ship-address" placeholder="Street + house number" />
                  </label>
                  <label>
                    Postcode
                    <input type="text" id="ship-postcode" placeholder="For example 2525 CP" />
                  </label>
                  <label>
                    City
                    <input type="text" id="ship-city" placeholder="The Hague" />
                  </label>
                  <label>
                    Land / regio
                    <select id="ship-region">
                      <option value="NL">The Netherlands</option>
                      <option value="EU">European Union</option>
                      <option value="WORLD">Worldwide</option>
                    </select>
                  </label>
                  <label>
                    Total weight (kg)
                    <input
                      type="number"
                      id="ship-weight"
                      step="0.1"
                      min="0"
                      placeholder="Will be filled in automatically"
                    />
                  </label>
                  <button type="submit" class="primary-btn full-width">
                    Calculate shipping costs
                  </button>
                </form>
              </div>

              <div class="checkout-right">
                <h3>Summary order</h3>
                <div class="summary-lines">
                  <p><span>Material price</span><span>€ <span id="summary-material">0.00</span></span></p>
                  <p><span>Shipping costs (demo)</span><span>€ <span id="summary-shipping">0.00</span></span></p>
                  <hr />
                  <p class="summary-total-row"><span>Total</span><span>€ <span id="summary-total">0.00</span></span></p>
                </div>
                <p class="summary-text">
                  Shipping rates in this demo:<br />
                  NL: up to 10 kg ≈ €7, then increments per 10 kg.<br />
                  EU: higher base price, Worldwide: even higher.<br />
                  For a true integration, an official PostNL/carrier API is required.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      © <span id="year"></span> CompoLink – Demo for project 4.1
    </footer>
  </div>

  <!-- ================= SCRIPTS ================= -->

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <script>
    (function initFirebase() {
      const cfg = {
        apiKey: "AIzaSyA2BScDGFFpNaLTn7d5wpbDjLjAWe6eVXY",
        authDomain: "compolink-112.firebaseapp.com",
        projectId: "compolink-112",
        storageBucket: "compolink-112.firebasestorage.app",
        messagingSenderId: "1045338539276",
        appId: "1:1045338539276:web:7dbc0b80b0889dd3dd7529",
        measurementId: "G-VF4TTS8CJD"
      };
      if (!firebase.apps.length) firebase.initializeApp(cfg);
      console.log("Firebase ready:", firebase.app().options.projectId);
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js" defer></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const stripList = document.getElementById("market-prices-strip");
      const cardList = document.getElementById("market-prices-card");
      if (!stripList && !cardList) return;

      const lists = [];
      if (stripList) lists.push(stripList);
      if (cardList) lists.push(cardList);

      const fallback = [
        { symbol: "GOLD", price: 2350 },
        { symbol: "SILVER", price: 29.3 },
        { symbol: "PLATINUM", price: 980 },
        { symbol: "PALLADIUM", price: 1040 }
      ];

      function renderLists(items) {
        lists.forEach((listEl) => {
          listEl.innerHTML = "";
          items.forEach(({ symbol, price }) => {
            const li = document.createElement("li");
            li.className = "market-price-item";
            li.innerHTML = `
              <span class="material-symbol">${symbol}</span>
              <span class="material-price">${price.toFixed(2)} USD</span>
            `;
            listEl.appendChild(li);
          });
        });
      }

      async function loadPrices() {
        try {
          const res = await fetch("https://api.metals.live/v1/spot");
          if (!res.ok) throw new Error("HTTP " + res.status);
          const data = await res.json();

          const symbols = ["gold", "silver", "platinum", "palladium"];
          const items = [];

          data.forEach(([symbol, price]) => {
            if (symbols.includes(String(symbol).toLowerCase())) {
              items.push({ symbol: String(symbol).toUpperCase(), price: Number(price) });
            }
          });

          if (!items.length) throw new Error("Geen geldige data");
          renderLists(items);
        } catch (err) {
          console.error("Fout bij laden koersen, gebruik fallback:", err);
          renderLists(fallback);
        }
      }

      loadPrices();
      setInterval(loadPrices, 600000);
    });
  </script>
</body>
</html>
