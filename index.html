<!doctype html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>CompoLink Platform</title>
  <meta name="description" content="CompoLink – connect EU composite buyers & suppliers in one platform." />
  <meta name="theme-color" content="#0b1020" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <noscript>
    Deze website heeft JavaScript nodig om te werken (login, feed, analytics).
  </noscript>

  <!-- ============ AUTH SCHERM ============ -->
  <div id="auth-wrapper" class="auth-wrapper">
    <div class="auth-card">
      <h1>CompoLink</h1>
      <p class="auth-subtitle">
        Connect EU composite buyers & suppliers in één platform.
      </p>

      <div class="auth-tabs">
        <button id="login-tab" class="auth-tab active" type="button">Log in</button>
        <button id="signup-tab" class="auth-tab" type="button">Sign up</button>
      </div>

      <!-- LOGIN -->
      <form id="login-form" class="auth-form">
        <label>
          E-mail
          <input type="email" id="login-email" autocomplete="email" required />
        </label>
        <label>
          Wachtwoord
          <input type="password" id="login-password" autocomplete="current-password" required />
        </label>
        <p id="login-error" class="auth-error" aria-live="polite"></p>
        <button type="submit" class="primary-btn">Log in</button>
      </form>

      <!-- SIGNUP -->
      <form id="signup-form" class="auth-form hidden">
        <label>
          Naam
          <input type="text" id="signup-name" autocomplete="name" required />
        </label>
        <label>
          E-mail
          <input type="email" id="signup-email" autocomplete="email" required />
        </label>
        <label>
          Wachtwoord
          <input type="password" id="signup-password" autocomplete="new-password" required />
        </label>

        <fieldset class="role-fieldset">
          <legend>Accounttype</legend>
          <label>
            <input type="radio" name="signup-role" value="buyer" checked />
            Buyer (OEM / MRO / integrator)
          </label>
          <label>
            <input type="radio" name="signup-role" value="seller" />
            Seller (materials / semi-finished)
          </label>
        </fieldset>

        <p id="signup-error" class="auth-error" aria-live="polite"></p>
        <button type="submit" class="primary-btn">Account aanmaken</button>
      </form>
    </div>
  </div>

  <!-- ============ APP (NA INLOGGEN) ============ -->
  <div id="app" class="app hidden">
    <header class="top-nav">
      <div class="nav-left">
        <span class="nav-logo">CompoLink</span>
      </div>

      <nav class="nav-center" aria-label="Primary navigation">
        <button class="nav-btn active" type="button" data-page="overview">Overview</button>
        <button class="nav-btn" type="button" data-page="stock">Stock</button>
        <button class="nav-btn" type="button" data-page="buyers">Buyers & Suppliers</button>
        <button class="nav-btn" type="button" data-page="analytics">Analytics</button>
        <button class="nav-btn" type="button" data-page="tracking">Tracking</button>
        <button class="nav-btn" type="button" data-page="community">Community feed</button>
        <button class="nav-btn" type="button" data-page="checkout">Checkout</button>
      </nav>

      <div class="nav-right">
        <span class="user-tag" id="user-tag">–</span>
        <button id="logout-btn" class="logout-btn" type="button">Log out</button>
      </div>
    </header>

    <div id="market-strip" class="market-strip">
      <span class="market-strip-label">Live material prices</span>
      <ul id="market-prices-strip" class="market-prices-strip"></ul>
      <span class="market-strip-note">
        Indicatieve spotprijzen (goud, zilver, etc.) in USD.
      </span>
    </div>

    <main class="main-wrapper">
      <!-- (jouw content blijft hetzelfde; ik laat hem hier weg om niet 2x te spammen) -->
      <!-- BELANGRIJK: laat jouw sections precies zoals je ze had -->
      <!-- ... -->

      <!-- ===== COMMUNITY FEED ===== -->
      <section id="community" class="page">
        <div class="community-shell">
          <div class="community-card">
            <h2>Community feed</h2>
            <p class="page-intro">
              Share updates on price, stock, certificates, and RFQs. New users can also see older posts.
            </p>

            <div class="community-layout">
              <aside class="community-sidebar">
                <h3>Groups</h3>
                <ul id="group-list" class="group-list"></ul>
              </aside>

              <div class="community-main">
                <div class="community-header">
                  <h3>Post an update in <span id="current-group-name">Market updates</span></h3>
                </div>

                <div id="post-feed" class="post-feed"></div>

                <form id="post-form" class="post-form">
                  <textarea
                    id="post-text"
                    rows="3"
                    placeholder="For example, 'New batch of T700 prepreg available, price update €23.90/kg...'"
                  ></textarea>

                  <div class="post-form-row">
                    <input type="file" id="post-file" />
                    <button id="postBtn" type="submit" class="primary-btn">Plaatsen</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ... -->
    </main>

    <footer class="app-footer">
      © <span id="year"></span> CompoLink – Demo for project 4.1
    </footer>
  </div>

  <!-- ================= SCRIPTS (juiste volgorde) ================= -->

  <!-- Firebase v8 CDN -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <!-- Firebase init: GEEN globale "firebaseConfig" variabele (voorkomt conflict met script.js) -->
  <script>
    (function initFirebase() {
      const cfg = {
        apiKey: "AIzaSyA2BScDGFFpNaLTn7d5wpbDjLjAWe6eVXY",
        authDomain: "compolink-112.firebaseapp.com",
        projectId: "compolink-112",
        storageBucket: "compolink-112.firebasestorage.app",
        messagingSenderId: "1045338539276",
        appId: "1:1045338539276:web:7dbc0b80b0889dd3dd7529",
        measurementId: "G-VF4TTS8CJD"
      };

      if (!firebase.apps.length) firebase.initializeApp(cfg);
      console.log("Firebase ready:", firebase.app().options.projectId);
    })();
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- JOUW HOOFDLOGICA -->
  <script src="script.js" defer></script>

  <!-- LIVE KOERSEN -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const stripList = document.getElementById("market-prices-strip");
      const cardList = document.getElementById("market-prices-card");

      if (!stripList && !cardList) return;

      const lists = [];
      if (stripList) lists.push(stripList);
      if (cardList) lists.push(cardList);

      const fallback = [
        { symbol: "GOLD", price: 2350 },
        { symbol: "SILVER", price: 29.3 },
        { symbol: "PLATINUM", price: 980 },
        { symbol: "PALLADIUM", price: 1040 }
      ];

      function renderLists(items) {
        lists.forEach((listEl) => {
          listEl.innerHTML = "";
          items.forEach(({ symbol, price }) => {
            const li = document.createElement("li");
            li.className = "market-price-item";
            li.innerHTML = `
              <span class="material-symbol">${symbol}</span>
              <span class="material-price">${price.toFixed(2)} USD</span>
            `;
            listEl.appendChild(li);
          });
        });
      }

      async function loadPrices() {
        try {
          const res = await fetch("https://api.metals.live/v1/spot");
          if (!res.ok) throw new Error("HTTP " + res.status);
          const data = await res.json();

          const symbols = ["gold", "silver", "platinum", "palladium"];
          const items = [];

          data.forEach(([symbol, price]) => {
            if (symbols.includes(String(symbol).toLowerCase())) {
              items.push({ symbol: String(symbol).toUpperCase(), price: Number(price) });
            }
          });

          if (!items.length) throw new Error("Geen geldige data");
          renderLists(items);
        } catch (err) {
          console.error("Fout bij laden koersen, gebruik fallback:", err);
          renderLists(fallback);
        }
      }

      loadPrices();
      setInterval(loadPrices, 600000);
    });
  </script>
</body>
</html>

